<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám To√°n 9 - Ph∆∞∆°ng tr√¨nh b·∫≠c hai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js" type="module"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        .btn-primary {
            transition: all 0.2s;
            background: #3b82f6;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .option-btn {
            transition: all 0.2s;
            border: 2px solid #e2e8f0;
            min-height: 60px;
        }
        .option-btn:not(:disabled):hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .correct { border-color: #22c55e !important; background-color: #f0fdf4 !important; }
        .wrong { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        
        .timer-bar {
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            overflow: hidden;
        }
        .timer-progress {
            height: 100%;
            background: #3b82f6;
            transition: width 1s linear;
        }
        /* ƒê·∫£m b·∫£o c√¥ng th·ª©c to√°n h·ªçc kh√¥ng b·ªã tr√†n */
        .mjx-container {
            font-size: 1.1em !important;
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center">

    <div id="app" class="w-full max-w-2xl glass-card p-6 md:p-10 relative overflow-hidden">
        <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'math-quiz-9-v2';

        let state = {
            screen: 'start',
            user: null,
            userName: '',
            userClass: '',
            currentQuestionIndex: 0,
            score: 0,
            timeLeft: 20, // ƒê√£ ch·ªânh th√†nh 20s
            timerInterval: null,
            isAnswered: false,
            leaderboard: [],
            questions: [
                {
                    q: "Trong c√°c ph∆∞∆°ng tr√¨nh sau, ph∆∞∆°ng tr√¨nh n√†o l√† ph∆∞∆°ng tr√¨nh b·∫≠c hai m·ªôt ·∫©n?",
                    options: ["$x + 2 = 0$", "$x^2 - 5x + 6 = 0$", "$x^3 - 1 = 0$", "$0x^2 + 3x - 1 = 0$"],
                    correct: 1,
                    explain: "Ph∆∞∆°ng tr√¨nh b·∫≠c hai m·ªôt ·∫©n c√≥ d·∫°ng $ax^2 + bx + c = 0$ v·ªõi $a \\neq 0$."
                },
                {
                    q: "Nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh $x^2 - 9 = 0$ l√†:",
                    options: ["$x = 3$", "$x = -3$", "$x = \\pm 3$", "$x = 9$"],
                    correct: 2,
                    explain: "$x^2 = 9 \\Rightarrow x = \\pm \\sqrt{9} = \\pm 3$."
                },
                {
                    q: "Cho ph∆∞∆°ng tr√¨nh $x^2 - 5x + 4 = 0$. T·ªïng c√°c h·ªá s·ªë $a + b + c$ l√† bao nhi√™u?",
                    options: ["$1$", "$-4$", "$0$", "$10$"],
                    correct: 2,
                    explain: "$a=1, b=-5, c=4$. Ta c√≥ $a+b+c = 1 + (-5) + 4 = 0$."
                },
                {
                    q: "√Åp d·ª•ng ƒë·ªãnh l√Ω Vi-√©t cho ph∆∞∆°ng tr√¨nh $x^2 - 7x + 10 = 0$. T·ªïng hai nghi·ªám $S$ v√† t√≠ch hai nghi·ªám $P$ l√†:",
                    options: ["$S=7, P=10$", "$S=-7, P=10$", "$S=10, P=7$", "$S=-10, P=-7$"],
                    correct: 0,
                    explain: "$S = -\\frac{b}{a} = -\\frac{-7}{1} = 7$; $P = \\frac{c}{a} = \\frac{10}{1} = 10$."
                },
                {
                    q: "T√¨m hai s·ªë $u$ v√† $v$ bi·∫øt $u + v = 15$ v√† $u \\cdot v = 56$.",
                    options: ["$7$ v√† $8$", "$6$ v√† $9$", "$5$ v√† $10$", "$11$ v√† $4$"],
                    correct: 0,
                    explain: "$u, v$ l√† nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh $x^2 - 15x + 56 = 0$. Nh·∫©m nghi·ªám th·∫•y $7+8=15$ v√† $7 \\cdot 8=56$."
                },
                {
                    q: "N·∫øu ph∆∞∆°ng tr√¨nh $ax^2 + bx + c = 0$ ($a \\neq 0$) c√≥ $a - b + c = 0$ th√¨ nghi·ªám c·ªßa n√≥ l√†:",
                    options: ["$x_1=1; x_2=\\frac{c}{a}$", "$x_1=-1; x_2=-\\frac{c}{a}$", "$x_1=1; x_2=-\\frac{c}{a}$", "$x_1=-1; x_2=\\frac{c}{a}$"],
                    correct: 1,
                    explain: "ƒê√¢y l√† tr∆∞·ªùng h·ª£p nh·∫©m nghi·ªám ƒë·∫∑c bi·ªát: N·∫øu $a-b+c=0$ th√¨ $x_1 = -1$ v√† $x_2 = -\\frac{c}{a}$."
                },
                {
                    q: "Bi·ªát th·ª©c $\\Delta$ (Delta) c·ªßa ph∆∞∆°ng tr√¨nh $x^2 - 4x + 4 = 0$ b·∫±ng:",
                    options: ["$4$", "$0$", "$-4$", "$16$"],
                    correct: 1,
                    explain: "$\\Delta = b^2 - 4ac = (-4)^2 - 4 \\cdot 1 \\cdot 4 = 16 - 16 = 0$."
                },
                {
                    q: "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i h∆°n chi·ªÅu r·ªông $2$ m v√† di·ªán t√≠ch l√† $24$ m$^2$. Chi·ªÅu r·ªông $x$ (m) l√† nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh n√†o?",
                    options: ["$x(x-2)=24$", "$x + (x+2) = 24$", "$x(x+2)=24$", "$x^2 + 2 = 24$"],
                    correct: 2,
                    explain: "Chi·ªÅu r·ªông l√† $x$, chi·ªÅu d√†i l√† $x+2$. Di·ªán t√≠ch l√† $x(x+2) = 24$."
                },
                {
                    q: "Gi√° tr·ªã c·ªßa $m$ ƒë·ªÉ ph∆∞∆°ng tr√¨nh $x^2 - mx + 3 = 0$ c√≥ m·ªôt nghi·ªám b·∫±ng $1$ l√†:",
                    options: ["$m=4$", "$m=-4$", "$m=3$", "$m=2$"],
                    correct: 0,
                    explain: "Thay $x=1$ v√†o ph∆∞∆°ng tr√¨nh: $1^2 - m(1) + 3 = 0 \\Rightarrow 4 - m = 0 \\Rightarrow m = 4$."
                },
                {
                    q: "Ph∆∞∆°ng tr√¨nh $x^2 + x + 1 = 0$ c√≥ bao nhi√™u nghi·ªám?",
                    options: ["$2$ nghi·ªám ph√¢n bi·ªát", "$1$ nghi·ªám k√©p", "$V√¥ nghi·ªám$", "$V√¥ s·ªë nghi·ªám$"],
                    correct: 2,
                    explain: "$\\Delta = 1^2 - 4 \\cdot 1 \\cdot 1 = -3 < 0$. V√¨ $\\Delta < 0$ n√™n ph∆∞∆°ng tr√¨nh v√¥ nghi·ªám."
                }
            ]
        };

        const appContainer = document.getElementById('app');

        const typesetMath = () => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            state.user = user;
            if (user) fetchLeaderboard();
        });

        const fetchLeaderboard = () => {
            if (!state.user) return;
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard'));
            onSnapshot(q, (snapshot) => {
                const data = [];
                snapshot.forEach(doc => data.push(doc.data()));
                state.leaderboard = data.sort((a, b) => b.score - a.score).slice(0, 10);
                if (state.screen === 'result') render();
            }, (err) => console.error(err));
        };

        const saveScore = async () => {
            if (!state.user) return;
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard'), {
                    name: state.userName,
                    class: state.userClass,
                    score: state.score,
                    timestamp: serverTimestamp()
                });
            } catch (e) { console.error(e); }
        };

        const render = () => {
            if (state.screen === 'start') {
                appContainer.innerHTML = `
                    <div class="text-center">
                        <div class="flex justify-center mb-6">
                            <div class="text-6xl animate-bounce">
                                üìê‚úèÔ∏èüçé
                            </div>
                        </div>
                        <h1 class="text-3xl font-bold text-blue-600 mb-2">ƒê·∫•u Tr∆∞·ªùng To√°n 9</h1>
                        <p class="text-gray-600 mb-8">Ph∆∞∆°ng tr√¨nh b·∫≠c hai & H·ªá th·ª©c Vi-√©t</p>
                        
                        <div class="space-y-4 max-w-sm mx-auto mb-8 text-left">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">H·ªç v√† T√™n</label>
                                <input type="text" id="nameInput" value="${state.userName}" placeholder="Nh·∫≠p t√™n..." class="w-full px-4 py-2 border rounded-xl outline-none focus:ring-2 focus:ring-blue-400">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">L·ªõp</label>
                                <input type="text" id="classInput" value="${state.userClass}" placeholder="V√≠ d·ª•: 9A..." class="w-full px-4 py-2 border rounded-xl outline-none focus:ring-2 focus:ring-blue-400">
                            </div>
                        </div>
                        
                        <button onclick="window.startQuiz()" class="btn-primary w-full py-3 text-white font-bold rounded-xl text-lg shadow-lg">B·∫Øt ƒë·∫ßu thi t√†i!</button>
                        <div class="mt-4 text-xs text-gray-400">M·ªói c√¢u h·ªèi c√≥ 20 gi√¢y ƒë·ªÉ ho√†n th√†nh</div>
                    </div>
                `;
            } else if (state.screen === 'quiz') {
                const q = state.questions[state.currentQuestionIndex];
                appContainer.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-bold text-blue-500">C√¢u ${state.currentQuestionIndex + 1}/10</span>
                        <span class="text-sm font-bold text-orange-500">H·∫°n ƒë·ªãnh: ${state.timeLeft}s</span>
                    </div>
                    
                    <div class="timer-bar mb-6">
                        <div id="timerProgress" class="timer-progress" style="width: ${(state.timeLeft / 20) * 100}%"></div>
                    </div>

                    <div class="mb-8">
                        <h2 class="text-xl font-semibold text-gray-800 leading-relaxed">${q.q}</h2>
                    </div>

                    <div class="grid gap-3 mb-6">
                        ${q.options.map((opt, idx) => `
                            <button 
                                onclick="window.checkAnswer(${idx})" 
                                class="option-btn p-4 rounded-xl text-left bg-white font-medium text-gray-700 ${state.isAnswered ? 'cursor-default' : 'hover:shadow-md'}"
                                id="opt-${idx}"
                                ${state.isAnswered ? 'disabled' : ''}
                            >
                                ${opt}
                            </button>
                        `).join('')}
                    </div>

                    <div id="feedback" class="hidden">
                        <div id="feedbackText" class="p-4 rounded-xl mb-4 font-bold text-center"></div>
                        <div class="bg-blue-50 p-4 rounded-xl text-sm text-blue-800 leading-relaxed mb-6">
                            <strong>G·ª£i √Ω gi·∫£i b√†i:</strong> <br>
                            <div class="mt-1">${q.explain}</div>
                        </div>
                        <button onclick="window.nextQuestion()" class="btn-primary w-full py-3 text-white font-bold rounded-xl">
                            ${state.currentQuestionIndex === 9 ? 'T·ªïng k·∫øt ƒëi·ªÉm' : 'Ti·∫øp t·ª•c c√¢u sau'}
                        </button>
                    </div>
                `;
            } else if (state.screen === 'result') {
                const remark = state.score >= 8 ? "Tuy·ªát v·ªùi! B·∫°n h·ªçc r·∫•t t·ªët." : state.score >= 5 ? "Kh√° t·ªët, c·ªë g·∫Øng l√™n nh√©!" : "H√£y √¥n t·∫≠p k·ªπ h∆°n v·ªÅ ph∆∞∆°ng tr√¨nh b·∫≠c hai.";
                appContainer.innerHTML = `
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">K·∫øt qu·∫£ cu·ªëi c√πng</h2>
                        <p class="text-gray-600 mb-6">H·ªçc sinh: <strong>${state.userName}</strong> - L·ªõp <strong>${state.userClass}</strong></p>
                        
                        <div class="inline-block p-8 bg-blue-50 rounded-full mb-6">
                            <span class="text-5xl font-bold text-blue-600">${state.score}/10</span>
                        </div>
                        
                        <p class="text-lg font-medium text-blue-700 mb-8">${remark}</p>
                        
                        <div class="mb-8 text-left">
                            <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">B·∫£ng x·∫øp h·∫°ng l·ªõp</h3>
                            <div class="max-h-48 overflow-y-auto pr-2">
                                <table class="w-full text-sm">
                                    <thead class="text-gray-400">
                                        <tr>
                                            <th class="text-left font-normal py-2">H·ªçc sinh</th>
                                            <th class="text-left font-normal py-2">L·ªõp</th>
                                            <th class="text-right font-normal py-2">ƒêi·ªÉm s·ªë</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-700">
                                        ${state.leaderboard.map(item => `
                                            <tr class="border-t">
                                                <td class="py-2">${item.name}</td>
                                                <td class="py-2">${item.class}</td>
                                                <td class="py-2 text-right font-bold">${item.score}/10</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <button onclick="window.restartQuiz()" class="btn-primary px-10 py-3 text-white font-bold rounded-xl">Th·ª≠ s·ª©c l·∫°i</button>
                    </div>
                `;
            }
            typesetMath();
        };

        window.startQuiz = () => {
            const name = document.getElementById('nameInput').value.trim();
            const clss = document.getElementById('classInput').value.trim();
            if (!name || !clss) { alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫°n nh√©!"); return; }
            state.userName = name; state.userClass = clss; state.screen = 'quiz';
            state.currentQuestionIndex = 0; state.score = 0;
            startTimer(); render();
        };

        const startTimer = () => {
            state.timeLeft = 20; // ƒê√£ ch·ªânh th√†nh 20s
            clearInterval(state.timerInterval);
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                if (state.timeLeft <= 0) { clearInterval(state.timerInterval); window.checkAnswer(-1); }
                const progress = document.getElementById('timerProgress');
                if (progress) progress.style.width = `${(state.timeLeft / 20) * 100}%`;
                const tText = document.querySelector('.text-orange-500');
                if (tText) tText.innerText = `H·∫°n ƒë·ªãnh: ${state.timeLeft}s`;
            }, 1000);
        };

        window.checkAnswer = (idx) => {
            if (state.isAnswered) return;
            state.isAnswered = true;
            clearInterval(state.timerInterval);
            const q = state.questions[state.currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            feedback.classList.remove('hidden');
            if (idx === q.correct) {
                state.score++;
                document.getElementById(`opt-${idx}`).classList.add('correct');
                feedbackText.innerText = "Ch√≠nh x√°c! ‚ú®";
                feedbackText.className = "p-4 rounded-xl mb-4 font-bold text-center text-green-600 bg-green-50";
            } else {
                if (idx !== -1) document.getElementById(`opt-${idx}`).classList.add('wrong');
                feedbackText.innerText = idx === -1 ? "H·∫øt th·ªùi gian! ‚è∞" : "Ch∆∞a ƒë√∫ng r·ªìi! üßä";
                feedbackText.className = "p-4 rounded-xl mb-4 font-bold text-center text-red-600 bg-red-50";
            }
            typesetMath();
        };

        window.nextQuestion = () => {
            state.isAnswered = false;
            if (state.currentQuestionIndex < 9) {
                state.currentQuestionIndex++;
                startTimer(); render();
            } else {
                state.screen = 'result';
                saveScore(); render();
            }
        };

        window.restartQuiz = () => { state.screen = 'start'; render(); };

        initAuth().then(render);
    </script>
</body>
</html>
